<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>AR ‚Äî Mapa √ëuble (Radar) ‚Äî √ëuble XR</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>
    body { margin:0; font-family:system-ui, Segoe UI, Roboto, Arial, sans-serif; background:#000; color:#fff }
    .hud { position:fixed; left:10px; top:10px; background:rgba(0,0,0,.55); padding:10px 12px; border-radius:10px; font-size:13px }
    .hud a { color:#7fe0ff; text-decoration:none; margin-right:8px }
    .hint { position:fixed; bottom:14px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,.55); padding:8px 12px; border-radius:10px; font-size:13px }
  
  <style>
    /* admin-fab */
    .adminFab{position:fixed;right:14px;bottom:14px;display:none;z-index:9998;
      background:#101a34;border:1px solid #223054;border-radius:14px;box-shadow:0 10px 30px #000a;
      padding:8px;gap:8px;align-items:center}
    .adminFab button{background:linear-gradient(135deg,#6EE7F9,#A78BFA);color:#0a1020;border:0;border-radius:10px;padding:8px 10px;font-weight:800;cursor:pointer}
    .adminFab .email{font-size:12px;color:#cfe0ff;margin-right:6px}
  </style>

</style>

  <style>
    /* help-overlay */
    .hud .btn{display:inline-block;background:linear-gradient(135deg,#6EE7F9,#A78BFA);color:#0a1020;font-weight:800;
      padding:6px 10px;border-radius:10px;text-decoration:none;margin-left:6px}
    .helpModal{position:fixed;inset:0;background:#0009;display:none;align-items:center;justify-content:center;z-index:9999}
    .helpCard{background:#101a34;border:1px solid #223054;border-radius:14px;max-width:560px;width:92%;color:#cfe0ff;padding:16px}
    .helpCard h3{margin:0 0 8px 0}
    .helpCard ul{margin:8px 0 0 18px}
    .helpCard .row{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
    .helpCard button{background:linear-gradient(135deg,#6EE7F9,#A78BFA);color:#0a1020;font-weight:800;border:none;border-radius:10px;padding:8px 12px;cursor:pointer}
  
  <style>
    /* admin-fab */
    .adminFab{position:fixed;right:14px;bottom:14px;display:none;z-index:9998;
      background:#101a34;border:1px solid #223054;border-radius:14px;box-shadow:0 10px 30px #000a;
      padding:8px;gap:8px;align-items:center}
    .adminFab button{background:linear-gradient(135deg,#6EE7F9,#A78BFA);color:#0a1020;border:0;border-radius:10px;padding:8px 10px;font-weight:800;cursor:pointer}
    .adminFab .email{font-size:12px;color:#cfe0ff;margin-right:6px}
  </style>

</style>


  <style>
    /* learn-ui */
    .hud .btn{display:inline-block;background:linear-gradient(135deg,#6EE7F9,#A78BFA);color:#0a1020;font-weight:800;
      padding:6px 10px;border-radius:10px;text-decoration:none;margin-left:6px}
    .modal{position:fixed;inset:0;background:#0009;display:none;align-items:center;justify-content:center;z-index:9999}
    .card{background:#101a34;border:1px solid #223054;border-radius:14px;max-width:620px;width:92%;color:#cfe0ff;padding:16px}
    .card h3{margin:0 0 8px 0}
    .card ol{margin:8px 0 0 18px}
    .row{display:flex;gap:8px;justify-content:flex-end;margin-top:12px;flex-wrap:wrap}
    .card button{background:linear-gradient(135deg,#6EE7F9,#A78BFA);color:#0a1020;font-weight:800;border:none;border-radius:10px;padding:8px 12px;cursor:pointer}
  
  <style>
    /* admin-fab */
    .adminFab{position:fixed;right:14px;bottom:14px;display:none;z-index:9998;
      background:#101a34;border:1px solid #223054;border-radius:14px;box-shadow:0 10px 30px #000a;
      padding:8px;gap:8px;align-items:center}
    .adminFab button{background:linear-gradient(135deg,#6EE7F9,#A78BFA);color:#0a1020;border:0;border-radius:10px;padding:8px 10px;font-weight:800;cursor:pointer}
    .adminFab .email{font-size:12px;color:#cfe0ff;margin-right:6px}
  </style>

</style>


  <style>
    /* learn-ui-extended */
    .hud .btn{display:inline-block;background:linear-gradient(135deg,#6EE7F9,#A78BFA);color:#0a1020;font-weight:800;
      padding:6px 10px;border-radius:10px;text-decoration:none;margin-left:6px}
    .modal{position:fixed;inset:0;background:#0009;display:none;align-items:center;justify-content:center;z-index:9999}
    .card{background:#101a34;border:1px solid #223054;border-radius:14px;max-width:720px;width:92%;color:#cfe0ff;padding:16px}
    .card h3{margin:0 0 6px 0}
    .card ul{margin:6px 0 0 18px}
    .row{display:flex;gap:8px;justify-content:flex-end;margin-top:12px;flex-wrap:wrap}
    .card button{background:linear-gradient(135deg,#6EE7F9,#A78BFA);color:#0a1020;font-weight:800;border:none;border-radius:10px;padding:8px 12px;cursor:pointer}
  
  <style>
    /* admin-fab */
    .adminFab{position:fixed;right:14px;bottom:14px;display:none;z-index:9998;
      background:#101a34;border:1px solid #223054;border-radius:14px;box-shadow:0 10px 30px #000a;
      padding:8px;gap:8px;align-items:center}
    .adminFab button{background:linear-gradient(135deg,#6EE7F9,#A78BFA);color:#0a1020;border:0;border-radius:10px;padding:8px 10px;font-weight:800;cursor:pointer}
    .adminFab .email{font-size:12px;color:#cfe0ff;margin-right:6px}
  </style>

</style>
</head>
<body>
  <div class="hud">
    <strong>AR ‚Äî Mapa √ëuble (Radar)</strong><br/>
    <a href="index.html">VR</a>
    <a href="../../index.html">‚Üê Portada</a>
  </div>
  <div class="hint">Mueve el tel√©fono y toca para colocar el terreno.
    <a class="btn" href="#" onclick="showHelp();return false;">‚ùì Ayuda</a>
    <a class="btn" href="#" onclick="showInfo();return false;">‚ÑπÔ∏è Info</a>
  </div>

  <div class="helpModal" id="helpModal"><div class="helpCard"><h3>Ayuda r√°pida</h3><ul><li>Mueve el tel√©fono para detectar plano.</li><li>Toca la pantalla para colocar el terreno.</li><li>Usa ARCore/ARKit (Android/iOS compatibles).</li></ul><div class="row"><button onclick="hideHelp()">Cerrar</button></div></div></div>

  <div class="helpModal" id="infoModal"><div class="helpCard"><h3>Informaci√≥n</h3>
  <p>Parte del portafolio √ëuble XR ‚Äî Ciencia y Futuro Inclusivo (PIE &amp; PAES).</p>
  <ul>
    <li>Compatibilidad: Oculus Quest 2/3, Chrome/Edge, Android.</li>
    <li>Uso educativo: escenas interactivas VR/AR y datos satelitales.</li>
    <li>Cr√©ditos: Colaboraci√≥n con Bel√©n Acu√±a (PIE, Sala SEM).</li>
  </ul>
  <div class="row"><button onclick="hideInfo()">Cerrar</button></div></div>
    <a class="btn" href="#" onclick="NXRCells.load('cells/cells.json');return false;">üß© Actividad</a>
    <a class="btn" href="#" onclick="NXRQuiz.load('quiz/questions.json');return false;">üß† Trivia</a>
  </div>

  <div class="modal" id="cellsModal"><div class="card"><h3>C√©lulas</h3><div id="cellsBox">Cargando‚Ä¶</div><div class="row"><button onclick="NXRCells.hide()">Cerrar</button></div></div></div>
  <div class="modal" id="quizModal"><div class="card"><h3>Trivia</h3><div id="quizBox">Cargando‚Ä¶</div><div class="row"><button onclick="NXRQuiz.hide()">Cerrar</button></div></div>
    <a class="btn" href="#" onclick="NXRCells.load('cells/cells.json');return false;">üß© Actividad</a>
    <a class="btn" href="#" onclick="NXRQuiz.load('quiz/questions.json');return false;">üß† Trivia</a>
    <a class="btn" href="#" onclick="showInfo();return false;">‚ÑπÔ∏è Sobre el proyecto</a>
  </div>

  <div class="modal" id="infoModal"><div class="card"><h3>Sobre el proyecto AR ‚Äî Mapa VR √ëuble (Radar)</h3>
    <ul><li>Coloca el relieve y aj√∫stalo con pinza.</li><li>Gira con dos dedos y arrastra sobre el plano.</li><li>√ösalo como maqueta aumentada.</li></ul>
    <div class="row"><button onclick="hideInfo()">Cerrar</button></div></div></div>

  <div class="modal" id="cellsModal"><div class="card"><h3>C√©lulas</h3><div id="cellsBox">Cargando‚Ä¶</div><div class="row"><button onclick="NXRCells.hide()">Cerrar</button></div></div></div>
  <div class="modal" id="quizModal"><div class="card"><h3>Trivia</h3><div id="quizBox">Cargando‚Ä¶</div><div class="row"><button onclick="NXRQuiz.hide()">Cerrar</button></div></div></div>

  <a-scene xr-mode-ui="enabled: true"
           webxr="optionalFeatures: hit-test, dom-overlay; overlayElement: .hud"
           renderer="colorManagement: true; antialias: true"
           background="color: #000"
           vr-mode-ui="enabled: false">
    <a-entity light="type: ambient; intensity: 0.7"></a-entity>
    <a-entity light="type: directional; intensity: 1" position="0 1 0"></a-entity>

    <a-entity id="anchor" visible="false"></a-entity>

    <a-entity camera look-controls="enabled:false"></a-entity>
  </a-scene>

  <script>
  // AR hit-test: tocar para colocar el terreno en el plano detectado
  const sceneEl = document.querySelector('a-scene');
  let placed = false;
  sceneEl.addEventListener('loaded', () => {
    const xr = sceneEl.renderer.xr;
    sceneEl.addEventListener('click', () => {
      if(placed) return;
      const anchor = document.getElementById('anchor');
      const terrain = document.createElement('a-entity');
      terrain.setAttribute('obj-model', 'obj: url(assets/terrain.obj)');
      terrain.setAttribute('material', 'src: url(assets/colormap.png); roughness:0.9; metalness:0.0');
      terrain.setAttribute('scale','0.05 0.05 0.05');
      terrain.setAttribute('rotation','-90 0 0');
      anchor.appendChild(terrain);
      anchor.setAttribute('visible','true');
      placed = true;
      document.querySelector('.hint').textContent = 'Terreno colocado. Puedes moverte alrededor.';
    });
  });
  </script>

  <script>
    function showHelp(){ document.getElementById('helpModal').style.display='flex'; }
    function hideHelp(){ document.getElementById('helpModal').style.display='none'; }
    function showInfo(){ document.getElementById('infoModal').style.display='flex'; }
    function hideInfo(){ document.getElementById('infoModal').style.display='none'; }
  </script>
<script src="quiz/quiz.js"></script>
<script src="cells/cells.js"></script>

<script>
function showInfo(){ document.getElementById('infoModal').style.display='flex'; }
function hideInfo(){ document.getElementById('infoModal').style.display='none'; }
</script>

<script>
/* movement-upgrades */
(function(){
  const SPEED=0.12, FAST=0.4, RISE=0.12;
  document.addEventListener('DOMContentLoaded', ()=>{
    const cam = document.querySelector('[camera]');
    let dragging=false, lastX=0, lastY=0, yaw=0, pitch=0;
    function move(dx,dy,dz){
      if(!cam) return;
      const el=cam.object3D;
      el.position.x += dx;
      el.position.y += dy;
      el.position.z += dz;
    }
    document.addEventListener('keydown', (e)=>{
      const fast = e.shiftKey;
      const s = fast?FAST:SPEED;
      if(e.key==='q' || e.key==='Q') move(0,-RISE,0);
      if(e.key==='e' || e.key==='E') move(0, RISE,0);
      if(e.key==='w' || e.key==='W') move(0,0,-s);
      if(e.key==='s' || e.key==='S') move(0,0, s);
      if(e.key==='a' || e.key==='A') move(-s,0,0);
      if(e.key==='d' || e.key==='D') move( s,0,0);
    });
    // simple orbit-like mouse drag (desktop)
    const canvas = document.querySelector('canvas');
    if(canvas){
      canvas.addEventListener('mousedown', (ev)=>{ dragging=true; lastX=ev.clientX; lastY=ev.clientY; });
      window.addEventListener('mouseup', ()=> dragging=false);
      window.addEventListener('mousemove', (ev)=>{
        if(!dragging) return;
        const dx = ev.clientX-lastX, dy = ev.clientY-lastY;
        lastX=ev.clientX; lastY=ev.clientY;
        yaw -= dx*0.002; pitch -= dy*0.002; pitch = Math.max(-1.2, Math.min(1.2, pitch));
        const rot = document.querySelector('[camera]').object3D.rotation;
        rot.y = yaw; rot.x = pitch;
      });
    }
    // minimal touch gestures for AR anchor entity with id="terrain" or "[data-draggable]"
    const target = document.getElementById('terrain') || document.querySelector('[data-draggable]');
    let tStartDist=0, tStartScale=1, tStartRot=0;
    let draggingTouch=false, tLastX=0, tLastY=0;
    function dist(a,b){ const dx=a.clientX-b.clientX, dy=a.clientY-b.clientY; return Math.hypot(dx,dy); }
    function angle(a,b){ return Math.atan2(b.clientY-a.clientY, b.clientX-a.clientX); }
    window.addEventListener('touchstart', (e)=>{
      if(!target) return;
      if(e.touches.length===1){ draggingTouch=true; tLastX=e.touches[0].clientX; tLastY=e.touches[0].clientY; }
      if(e.touches.length===2){ tStartDist=dist(e.touches[0], e.touches[1]); tStartRot=angle(e.touches[0], e.touches[1]); const s=target.object3D.scale; tStartScale=s.x; }
    }, {passive:true});
    window.addEventListener('touchmove', (e)=>{
      if(!target) return;
      if(e.touches.length===1 && draggingTouch){
        const dx=e.touches[0].clientX-tLastX, dy=e.touches[0].clientY-tLastY;
        tLastX=e.touches[0].clientX; tLastY=e.touches[0].clientY;
        target.object3D.position.x += dx*0.0008;
        target.object3D.position.z += dy*0.0008;
      }
      if(e.touches.length===2){
        const d=dist(e.touches[0],e.touches[1]);
        const a=angle(e.touches[0],e.touches[1]);
        const scale = Math.max(0.1, Math.min(5, tStartScale*(d/tStartDist)));
        target.object3D.scale.set(scale,scale,scale);
        target.object3D.rotation.y += (a - tStartRot);
        tStartRot=a; tStartDist=d;
      }
    }, {passive:true});
    window.addEventListener('touchend', ()=>{ draggingTouch=false; });
  });
})();
</script>


  <div class="adminFab" id="adminFab">
    <span class="email" id="fabEmail"></span>
    <button id="fabProtect">üõ°Ô∏è Protegido</button>
    <button onclick="location.href='acciones.html'">‚öôÔ∏è Acciones</button>
    <button id="fabLogout">üö™ Salir</button>
  </div>
  <script>
  (function(){
    function reveal(){
      try{
        const authed = localStorage.getItem('nxr_auth')==='1';
        const email = (localStorage.getItem('nxr_email')||'').toLowerCase();
        const allowed = (window.NXR_CONFIG && Array.isArray(NXR_CONFIG.allowedEmails)) ? NXR_CONFIG.allowedEmails.map(e=>e.toLowerCase()) : [];
        const ok = authed && email && allowed.includes(email);
        const fab = document.getElementById('adminFab');
        const lab = document.getElementById('fabEmail');
        if(!fab) return;
        if(ok){
          fab.style.display='flex';
          if(lab) lab.textContent = email;
        }else{
          fab.style.display='none';
        }
      }catch(e){}
    }
    function syncProtectLabel(){
      const on = localStorage.getItem('nxr_protect')==='1';
      const btn = document.getElementById('fabProtect');
      if(btn) btn.textContent = on ? 'üõ°Ô∏è Protegido ON' : 'üõ°Ô∏è Protegido OFF';
      if(on){ document.body.classList.add('protected'); } else { document.body.classList.remove('protected'); }
    }
    document.addEventListener('DOMContentLoaded', ()=>{
      reveal(); syncProtectLabel();
      const p = document.getElementById('fabProtect');
      const l = document.getElementById('fabLogout');
      if(p) p.onclick = ()=>{ if(localStorage.getItem('nxr_protect')==='1'){ localStorage.removeItem('nxr_protect'); } else { localStorage.setItem('nxr_protect','1'); } syncProtectLabel(); };
      if(l) l.onclick = ()=>{ localStorage.removeItem('nxr_auth'); localStorage.removeItem('nxr_email'); location.href='index.html'; };
    });
  })();
  </script>


<script>
document.addEventListener('contextmenu', function(e){ if(document.body.classList.contains('protected')) e.preventDefault(); }, true);
document.addEventListener('keydown', function(e){
  if(!document.body.classList.contains('protected')) return;
  if ((e.ctrlKey && (e.key==='u'||e.key==='U'||e.key==='s'||e.key==='S'||e.key==='c'||e.key==='C'))
       || e.key==='F12' || (e.ctrlKey && e.shiftKey && (e.key==='I'||e.key==='i'||e.key==='J'||e.key==='j'))) {
    e.preventDefault(); e.stopPropagation(); alert('Acci√≥n deshabilitada en modo presentaci√≥n.'); return false;
  }
}, true);
</script>
</body>
</html>
