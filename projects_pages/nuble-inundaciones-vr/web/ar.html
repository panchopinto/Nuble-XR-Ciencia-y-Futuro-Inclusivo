<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>AR ‚Äî Inundaciones y crecidas ‚Äî √ëuble XR</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>
    body{margin:0;background:#000;color:#fff;font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif}
    .hud{position:fixed;left:10px;top:10px;background:rgba(0,0,0,.55);padding:10px 12px;border-radius:10px;font-size:13px}
    .hud a{color:#7fe0ff;text-decoration:none;margin-right:8px}
    .hint{position:fixed;bottom:14px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,.55);padding:8px 12px;border-radius:10px;font-size:13px}
    .panel{position:fixed;right:10px;top:10px;background:rgba(0,0,0,.55);padding:10px 12px;border-radius:10px;font-size:13px}
    .panel label{display:block;margin-top:6px}
  </style>

  <style>
    /* help-overlay */
    .hud .btn{display:inline-block;background:linear-gradient(135deg,#6EE7F9,#A78BFA);color:#0a1020;font-weight:800;
      padding:6px 10px;border-radius:10px;text-decoration:none;margin-left:6px}
    .helpModal{position:fixed;inset:0;background:#0009;display:none;align-items:center;justify-content:center;z-index:9999}
    .helpCard{background:#101a34;border:1px solid #223054;border-radius:14px;max-width:560px;width:92%;color:#cfe0ff;padding:16px}
    .helpCard h3{margin:0 0 8px 0}
    .helpCard ul{margin:8px 0 0 18px}
    .helpCard .row{display:flex;gap:8px;justify-content:flex-end;margin-top:12px}
    .helpCard button{background:linear-gradient(135deg,#6EE7F9,#A78BFA);color:#0a1020;font-weight:800;border:none;border-radius:10px;padding:8px 12px;cursor:pointer}
  </style>


  <style>
    /* learn-ui */
    .hud .btn{display:inline-block;background:linear-gradient(135deg,#6EE7F9,#A78BFA);color:#0a1020;font-weight:800;
      padding:6px 10px;border-radius:10px;text-decoration:none;margin-left:6px}
    .modal{position:fixed;inset:0;background:#0009;display:none;align-items:center;justify-content:center;z-index:9999}
    .card{background:#101a34;border:1px solid #223054;border-radius:14px;max-width:620px;width:92%;color:#cfe0ff;padding:16px}
    .card h3{margin:0 0 8px 0}
    .card ol{margin:8px 0 0 18px}
    .row{display:flex;gap:8px;justify-content:flex-end;margin-top:12px;flex-wrap:wrap}
    .card button{background:linear-gradient(135deg,#6EE7F9,#A78BFA);color:#0a1020;font-weight:800;border:none;border-radius:10px;padding:8px 12px;cursor:pointer}
  </style>

</head>
<body>
  <div class="hud">
    <strong>AR ‚Äî Inundaciones y crecidas</strong><br/>
    <a href="index.html">VR</a>
    <a href="../../index.html">‚Üê Portada</a>
  </div>
  <div class="hint">Mueve el tel√©fono y toca para colocar el terreno.</div>
  <div class="panel">
    <div>Extensi√≥n de agua:</div>
    <label><input type="radio" name="flood" value="pre" checked> Antes</label>
    <label><input type="radio" name="flood" value="post"> Despu√©s (crecida)</label>
    <label style="margin-top:8px">Opacidad agua: <input id="alpha" type="range" min="0" max="1" step="0.05" value="0.6"></label>
  
    <a class="btn" href="#" onclick="showHelp();return false;">‚ùì Ayuda</a>
    <a class="btn" href="#" onclick="showInfo();return false;">‚ÑπÔ∏è Info</a>
  </div>

  <div class="helpModal" id="helpModal"><div class="helpCard"><h3>Ayuda r√°pida</h3><ul><li>Mueve el tel√©fono para detectar plano.</li><li>Toca para colocar el terreno AR.</li><li>Alterna Antes/Despu√©s y ajusta opacidad.</li></ul><div class="row"><button onclick="hideHelp()">Cerrar</button></div></div></div>

  <div class="helpModal" id="infoModal"><div class="helpCard"><h3>Informaci√≥n</h3>
  <p>Parte del portafolio √ëuble XR ‚Äî Ciencia y Futuro Inclusivo (PIE &amp; PAES).</p>
  <ul>
    <li>Compatibilidad: Oculus Quest 2/3, Chrome/Edge, Android.</li>
    <li>Uso educativo: escenas interactivas VR/AR y datos satelitales.</li>
    <li>Cr√©ditos: Colaboraci√≥n con Bel√©n Acu√±a (PIE, Sala SEM).</li>
  </ul>
  <div class="row"><button onclick="hideInfo()">Cerrar</button></div></div>
    <a class="btn" href="#" onclick="NXRCells.load('cells/cells.json');return false;">üß© Actividad</a>
    <a class="btn" href="#" onclick="NXRQuiz.load('quiz/questions.json');return false;">üß† Trivia</a>
  </div>

  <div class="modal" id="cellsModal"><div class="card"><h3>C√©lulas</h3><div id="cellsBox">Cargando‚Ä¶</div><div class="row"><button onclick="NXRCells.hide()">Cerrar</button></div></div></div>
  <div class="modal" id="quizModal"><div class="card"><h3>Trivia</h3><div id="quizBox">Cargando‚Ä¶</div><div class="row"><button onclick="NXRQuiz.hide()">Cerrar</button></div></div></div>

  <a-scene xr-mode-ui="enabled: true"
           webxr="optionalFeatures: hit-test, dom-overlay; overlayElement: .hud"
           renderer="colorManagement: true; antialias: true"
           background="color: #000"
           vr-mode-ui="enabled: false">
    <a-entity light="type: ambient; intensity: 0.7"></a-entity>
    <a-entity light="type: directional; intensity: 1" position="0 1 0"></a-entity>

    <a-entity id="anchor" visible="false"></a-entity>
    <a-entity camera look-controls="enabled:false"></a-entity>
  </a-scene>

  <script>
  const anchor = document.getElementById('anchor');
  let placed = false;
  document.querySelector('a-scene').addEventListener('click', () => {
    if(placed) return;
    // terreno
    const t = document.createElement('a-entity');
    t.setAttribute('obj-model','obj: url(assets/terrain.obj)');
    t.setAttribute('material','src: url(assets/colormap.png); roughness:0.9; metalness:0.0');
    t.setAttribute('rotation','-90 0 0');
    t.setAttribute('scale','0.05 0.05 0.05');
    anchor.appendChild(t);
    // overlays
    const pre = document.createElement('a-plane');
    pre.setAttribute('id','waterPre');
    pre.setAttribute('material','src: url(assets/flood_pre.png); transparent:true; opacity:0.6; color:#2ea3ff; blending:additive');
    pre.setAttribute('rotation','-90 0 0');
    pre.setAttribute('width','192'); pre.setAttribute('height','192');
    anchor.appendChild(pre);

    const post = document.createElement('a-plane');
    post.setAttribute('id','waterPost');
    post.setAttribute('material','src: url(assets/flood_post.png); transparent:true; opacity:0.0; color:#2ea3ff; blending:additive');
    post.setAttribute('rotation','-90 0 0');
    post.setAttribute('width','192'); post.setAttribute('height','192');
    anchor.appendChild(post);

    anchor.setAttribute('visible','true');
    placed = true;
    document.querySelector('.hint').textContent = 'Terreno colocado. Usa los controles para ver Antes/Despu√©s.';
  });

  function updateOpacity(){
    const value = document.getElementById('alpha').value;
    const onPre = document.querySelector('input[name="flood"][value="pre"]').checked;
    const pre = document.getElementById('waterPre');
    const post = document.getElementById('waterPost');
    if(pre&&post){
      pre.setAttribute('material','src: assets/flood_pre.png; transparent:true; opacity:'+(onPre?value:0)+'; color:#2ea3ff; blending:additive');
      post.setAttribute('material','src: assets/flood_post.png; transparent:true; opacity:'+(onPre?0:value)+'; color:#2ea3ff; blending:additive');
    }
  }
  document.querySelectorAll('input[name="flood"]').forEach(r => r.addEventListener('change', updateOpacity));
  document.getElementById('alpha').addEventListener('input', updateOpacity);
  </script>

  <script>
    function showHelp(){ document.getElementById('helpModal').style.display='flex'; }
    function hideHelp(){ document.getElementById('helpModal').style.display='none'; }
    function showInfo(){ document.getElementById('infoModal').style.display='flex'; }
    function hideInfo(){ document.getElementById('infoModal').style.display='none'; }
  </script>
<script src="quiz/quiz.js"></script>
<script src="cells/cells.js"></script>
</body>
</html>
